1. โค้ดที่ป้องกันการล็อกเงินไว้ใน contract
ฟังก์ชัน claimTimeout():
เมื่อเข้าสู่สถานะ WaitingForReveals แล้วผู้เล่นบางคนอาจจะไม่ใช้ฟังก์ชัน reveal ทำให้การตัดสินผลช้าและเงินที่ฝากไว้ถูกล็อกไว้ในสัญญา
ฟังก์ชันนี้จะตรวจสอบว่าเวลาปัจจุบันเกินกว่าที่ตั้งไว้แล้วหรือเปล่า
ถ้าผู้เล่นที่เรียกใช้มีการ reveal แล้ว แต่อีกฝ่ายยังไม่ reveal ผู้ที่ reveal จะได้รับรางวัลทั้งหมดและเกมจะรีเซ็ตใหม่
ถ้าทั้งสองฝ่ายไม่ reveal ให้ผู้เล่นแต่ละคนเรียกถอนเงินคืน deposit ของตัวเอง โดยใช้ mapping withdrawn เพื่อป้องกันการถอนซ้ำ และเมื่อทั้งสองถอนเงินแล้วก็รีเซ็ตเกม

2. โค้ดส่วนที่ทำการซ่อน choice และ commit
ฟังก์ชัน commit(bytes32 _commitment):
ผู้เล่นจะส่งค่า commitment hash ซึ่งเป็นการผสาน (concatenate) ของค่า choice กับ salt แบบสุ่ม แล้ว hash 
โค้ดตรวจสอบให้แน่ใจว่า เกมอยู่ในช่วง commit (WaitingForCommits)
ผู้เล่นนั้นเป็นผู้เล่นที่ลงทะเบียนแล้ว
ยังไม่ได้ commit ไปแล้ว (!hasCommitted[msg.sender])
เมื่อผ่านเงื่อนไขแล้ว ระบบจะบันทึกค่า commitment ใน mapping commitments และตั้งค่าสถานะ hasCommitted เป็น true
การซ่อน choice ด้วยวิธีนี้ช่วยป้องกันไม่ให้ผู้เล่นคนอื่นเห็น choice ก่อนที่จะถึงเวลาที่เปิดเผย

3. โค้ดส่วนที่จัดการกับความล่าช้าเมื่อผู้เล่นไม่ครบทั้งสองคน
ฟังก์ชัน claimTimeout():
ฟังก์ชันนี้จะถูกเรียกใช้ในกรณีที่ผู้เล่นไม่เรียก reveal ภายในเวลาที่กำหนด
โค้ดจะตรวจสอบว่าเวลาปัจจุบันเกินเวลาแล้ว
จากนั้นจะแยกกรณีการจัดการ:
กรณีที่มีผู้เล่น reveal แล้ว และอีกฝ่ายไม่ reveal:
ผู้เล่นที่ได้ reveal จะได้รับเงินรางวัลทั้งหมด
กรณีที่ทั้งสองฝ่ายไม่ reveal:
ผู้เล่นแต่ละคนสามารถเรียกถอนเงินคืนด้วยฟังก์ชันนี้ได้ โดยมีการบันทึกว่าแต่ละคนถอนไปแล้ว และเมื่อตรวจพบว่าทั้งสองฝ่ายได้ถอนแล้ว (countWithdrawn == 2) เกมจะรีเซ็ต
วิธีนี้ช่วยให้เงินที่ฝากไว้ไม่ติดอยู่ในสัญญาโดยไม่มีการดำเนินการต่อไป

4. โค้ดส่วนทำการ reveal และนำ choice มาตัดสินผู้ชนะ
ฟังก์ชัน reveal(uint _choice, string memory salt):

ผู้เล่นจะต้องเปิดเผยค่า choice พร้อมกับ salt ที่ใช้ในการสร้าง commitment ก่อนหน้านี้
โค้ดจะตรวจสอบเงื่อนไข:
เกมอยู่ในช่วง WaitingForReveals
ผู้เล่นนั้นลงทะเบียนและได้ทำการ commit ไปแล้ว ยังไม่ได้เปิดเผย
จากนั้นจะตรวจสอบความถูกต้องของการเปิดเผยโดยเปรียบเทียบผล keccak256(abi.encodePacked(_choice, salt)) กับค่าใน mapping commitments หากตรงกันก็ถือว่าเปิดเผยถูกต้อง
ระบบจะบันทึกค่า _choice ใน mapping revealedChoice และตั้งค่าสถานะ hasRevealed เป็น true
เมื่อผู้เล่นทั้งสองได้เปิดเผยแล้ว จะใช้ฟังก์ชัน _checkWinnerAndPay() เพื่อคำนวณและให้เงิน

หน้าที่ของฟังก์ชัน _checkWinnerAndPay():

ดึงค่า choice ของผู้เล่นทั้งสอง
หาก choice เท่ากัน ถือว่าเป็นการเสมอ และจ่ายรางวัลแบ่งครึ่งให้กับผู้เล่นทั้งสอง

หากไม่เท่ากัน จะคำนวณความแตกต่างด้วยสูตร:

diff = (5 + choice0 - choice1) % 5
ถ้า diff == 1 หรือ 2 ให้ผู้เล่นคนแรกชนะ
ถ้า diff == 3 หรือ 4 ให้ผู้เล่นคนที่สองชนะ
